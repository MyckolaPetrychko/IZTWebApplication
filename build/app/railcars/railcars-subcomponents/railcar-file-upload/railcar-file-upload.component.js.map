{"version":3,"sources":["app/railcars/railcars-subcomponents/railcar-file-upload/railcar-file-upload.component.ts"],"names":[],"mappings":"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","file":"app/railcars/railcars-subcomponents/railcar-file-upload/railcar-file-upload.component.js","sourcesContent":["import { Component } from '@angular/core';\r\nimport { SafeResourceUrl, DomSanitizationService } from '@angular/platform-browser';\r\n\r\n// import { TranslatePipe }  from 'ng2-translate';\r\nimport { RailcarService } from '../../common/services/railcars-http/railcars.service';\r\n// import { AlertComponent } from '../../../shared/alert/alert.component';\r\n// import { DataFilterService } from '../../../filters-data/filter-data.service';\r\n\r\n@Component({\r\n    moduleId: module.id,\r\n    selector: 'wblg-railcar-file-upload',\r\n    templateUrl: 'railcar-file-upload.component.html',\r\n    // pipes: [TranslatePipe],\r\n    // directives: [AlertComponent]\r\n})\r\n\r\nexport class RailcarFileUploadComponent {\r\n\r\n    public content: string;\r\n    public contentSpan: string;\r\n    public fname: string;\r\n    public url: SafeResourceUrl;\r\n    public isDisabledEditor: boolean;\r\n\r\n    private message: string;\r\n    private visibility: boolean;\r\n    private type: string;\r\n    private time: number;\r\n\r\n    private editBtnClass: { [key: string]: boolean };\r\n    private editBtnIconClass: { [key: string]: boolean };\r\n\r\n    constructor(private _railcar: RailcarService,\r\n        private _sn: DomSanitizationService) {\r\n        this.setDisabledEditor(true);\r\n        this.visibility = false;\r\n    }\r\n\r\n    public readNow(input: HTMLInputElement): void {\r\n        var file: File = input.files[0];\r\n        this.fname = file.name;\r\n\r\n        var myReader: FileReader = new FileReader();\r\n        myReader.readAsText(file);\r\n\r\n        myReader.onloadend = (e) => {\r\n            this.content = myReader.result;\r\n            this.contentSpan = this.Syntax(this.content);\r\n            this.save(this.content);\r\n        };\r\n    }\r\n\r\n    public setDisabledEditor(val: boolean): void {\r\n        this.isDisabledEditor = val;\r\n        this.editBtnClass = {\r\n            'btn-checked': !this.isDisabledEditor,\r\n            'btn-active': !this.isDisabledEditor,\r\n        }\r\n        this.editBtnIconClass = {\r\n            'fa-file-text-o': this.isDisabledEditor,\r\n            'fa-edit': !this.isDisabledEditor\r\n        }\r\n    }\r\n\r\n    public save(data: string): void {\r\n        this.content = data;\r\n        var blob = new Blob([this.content], { type: 'application/xml' });\r\n        this.url = this._sn.bypassSecurityTrustUrl((window.URL.createObjectURL(blob)));\r\n    }\r\n\r\n    public load(): void {\r\n        this.setMessage('MESSAGE.LOADING', 5);\r\n        this._railcar.getRailcarFile(this.content).subscribe((data: string): void => {\r\n            this.content = data;\r\n            this.syntaxInputText();\r\n        }, (err: string): void => {\r\n            this.setMessage(err, 0, 'error');\r\n\r\n        });\r\n    }\r\n\r\n    private changeSpannedText(data: HTMLElement): void {\r\n        this.content = data.innerText;\r\n        this.save(this.content);\r\n    }\r\n\r\n    private syntaxInputText() {\r\n        this.contentSpan = this.Syntax(this.content);\r\n    }\r\n\r\n    private setMessage(_mess: string, _time: number, _type: string = 'info'): void {\r\n        this.message = _mess;\r\n        this.time = _time;\r\n        this.type = _type;\r\n        this.visibility = true;\r\n    }\r\n\r\n    private clearSyntax(code: string): string {\r\n        let clearCode: string = code;\r\n        var comments: string[] = [];\r\n        var strings: string[] = [];\r\n        var textxml: string[] = [];\r\n        var all = { 'C': comments, 'S': strings, 'R': textxml };\r\n        var safe = {\r\n            '&lt;': '<',\r\n            '&gt;': '>',\r\n            '&#47;': '/',\r\n            '&nbsp;': ' ',\r\n            '&amp;': '&'\r\n        }\r\n        //--> get all comments\r\n        clearCode = clearCode.replace(\r\n            /<span class=\\\"C\\\">(&lt;\\!\\-\\-[\\W\\w]*?\\-\\-\\&gt\\;)<\\/span>/g,\r\n            (m: string, txt: string): string => {\r\n                var l = comments.length;\r\n                comments.push(txt);\r\n                return '~~~C' + l + '~~~';\r\n            });\r\n        //--> get text bettwen '<' and '>'\r\n        clearCode = clearCode.replace(\r\n            /<span class=\\\"R\\\">([\\w\\W]*?)<\\/span\\>/g,\r\n            (m, s) => {\r\n                var l = textxml.length;\r\n                textxml.push(s);\r\n                return '~~~R' + l + '~~~';\r\n            });\r\n        //--> get strings (attribute values)\r\n        clearCode = clearCode.replace(\r\n            /<span class=\\\"S\\\">([\\w\\W]*?)<\\/span\\>/gi,\r\n            (m: string, s: string): string => {\r\n                var l = strings.length;\r\n                strings.push(s);\r\n                return '~~~S' + l + '~~~';\r\n            });\r\n        //--> set bold attributte name\r\n        clearCode = clearCode.replace(/\\<span class=\\\"kwrd\\\">([\\w\\W]*?)<\\/span\\>/gi, '$1');\r\n        //--> set propertys \r\n        clearCode = clearCode.replace(/\\<span class=\\\"func kwrd\\\">([\\w\\W]*?)<\\/span\\>/gi, '$1');\r\n        clearCode = clearCode.replace(/\\<span class=\\\"func kwrd\\\">([\\w\\W]*?)<\\/span\\>/gi, '$1');\r\n        //--> return strings | text | comments || 2 - comment bettween texts\r\n        clearCode = clearCode\r\n            .replace(/~~~([SR])(\\d+)~~~/g,\r\n            (m: string, t: string, i: number): string => {\r\n                return all[t][i];\r\n            })\r\n            .replace(/~~~([C])(\\d+)~~~/g,\r\n            (m: string, t: string, i: number): string => {\r\n                return all[t][i];\r\n            });\r\n        //--> returned HTML\r\n        clearCode = clearCode.replace(/(\\&lt\\;|\\&gt;|\\&\\#47;|\\&nbsp;|\\&amp;)/g, (m: string) => {\r\n            return safe[m];\r\n        });\r\n        clearCode = clearCode.replace(/<br\\/>/g, '\\n');\r\n\r\n        return clearCode;\r\n    }\r\n\r\n\r\n    //--> NOTE: from  https://habrahabr.ru/post/43030/\r\n    private Syntax(code: string): string {\r\n        let code_rex: string = code;\r\n        var comments: string[] = [];\r\n        var strings: string[] = [];\r\n        var textxml: string[] = [];\r\n        var all = { 'C': comments, 'S': strings, 'R': textxml };\r\n        var safe = {\r\n            '<': '&lt;',\r\n            '>': '&gt;',\r\n            '/': '&#47;',\r\n            ' ': '&nbsp;',\r\n            '\\t': '&nbsp;&nbsp;&nbsp;&nbsp;',\r\n            '&': '&amp;'\r\n        };\r\n        //--> Hide <>/&\r\n        code_rex = code_rex.replace(\r\n            /[<> \\t/&]/g,\r\n            (m: string): string => {\r\n                return safe[m];\r\n            });\r\n        //--> comments\r\n        code_rex = code_rex.replace(/&lt;\\!\\-\\-([\\W\\w]*?)\\-\\-\\&gt\\;/g,\r\n            (m: string): string => {\r\n                var l = comments.length;\r\n                comments.push(m);\r\n                return '~~~C' + l + '~~~';\r\n            });\r\n        //--> strings\r\n        code_rex = code_rex.replace(\r\n            /&gt;([\\w\\W]*?)&lt;/g,\r\n            (m, s) => {\r\n                var l = textxml.length;\r\n                textxml.push(s);\r\n                return '&gt;~~~R' + l + '~~~&lt;';\r\n            });\r\n        //--> text xml\r\n        code_rex = code_rex.replace(\r\n            /((?:'(?:\\\\'|[^'])*')|(?:\"(?:\\\\\"|[^\"])*\"))/g,\r\n            (m: string, f: string): string => {\r\n                var l = strings.length;\r\n                strings.push(f);\r\n                return '~~~S' + l + '~~~';\r\n            });\r\n        //--> XML attribute\r\n        code_rex = code_rex.replace(/(([\\w](:\\w)?)*)=/gi, '<span class=\"kwrd\">$1</span>=');\r\n        //--> XML Params\r\n        code_rex = code_rex\r\n            .replace(/([a-z\\d_\\-\\;\\#\\?\\!\\&\\:]*)&gt;/gi, '<span class=\"func kwrd\">$1&gt;</span>')\r\n            .replace(/&lt;(\\W*[a-z0-9_\\-\\;\\:]*)(&nbsp;)?/gi, '<span class=\"func kwrd\">&lt;$1$2</span>');\r\n        //--> return strings | text | comments || 2 - comment bettween texts\r\n        code_rex = code_rex\r\n            .replace(/~~~([SR])(\\d+)~~~/g,\r\n            (m: string, t: string, i: number): string => {\r\n                return '<span class=\"' + t + '\">' + all[t][i] + '</span>';\r\n            })\r\n            .replace(/~~~([C])(\\d+)~~~/g,\r\n            (m: string, t: string, i: number): string => {\r\n                return '<span class=\"' + t + '\">' + all[t][i] + '</span>';\r\n            });\r\n        //--> check \\n\r\n        code_rex = code_rex.replace(/\\n/g, '<br/>');\r\n        return code_rex;\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}