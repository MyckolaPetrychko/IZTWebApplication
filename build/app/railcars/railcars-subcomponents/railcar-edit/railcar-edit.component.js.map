{"version":3,"sources":["app/railcars/railcars-subcomponents/railcar-edit/railcar-edit.component.ts"],"names":[],"mappings":"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","file":"app/railcars/railcars-subcomponents/railcar-edit/railcar-edit.component.js","sourcesContent":["import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { Router, ActivatedRoute }       from '@angular/router';\r\nimport { FORM_DIRECTIVES } from '@angular/forms';\r\nimport { NgIf, NgClass } from '@angular/common';\r\n\r\nimport { Observable }                   from 'rxjs/Observable';\r\nimport { Subscription }                   from 'rxjs/Subscription';\r\n\r\nimport { TranslatePipe }  from 'ng2-translate/ng2-translate';\r\nimport { RailcarService } from '../../common/services/railcars-http/railcars.service';\r\nimport { IRailcarEditModel } from './railcar-edit.model';\r\n\r\nimport {IDataModel} from '../../common/services/filters-data/data.model';\r\n// import { DataComboboxComponent } from '../.././../shared/data-combobox/data-combobox.component';\r\n// import { AlertComponent } from '../../../shared/alert/alert.component';\r\n// import { MyDatePicker } from '../../../shared/my-date-picker/my-date-picker.component';\r\n\r\nimport { DataFilterService } from '../../common/services/filters-data/filter-data.service';\r\n// import { RailcarNumberValidator} from '../../../common/directives/railcar-number.validator';\r\n\r\n@Component({\r\n    moduleId: module.id,\r\n    selector: 'wblg-railcar-edit',\r\n    templateUrl: 'railcar-edit.component.html',\r\n    // pipes: [TranslatePipe],\r\n    // directives: [DataComboboxComponent, AlertComponent, FORM_DIRECTIVES,  MyDatePicker, RailcarNumberValidator]\r\n})\r\nexport class RailcarEditComponent implements OnInit, OnDestroy {\r\n    public railcar: IRailcarEditModel;\r\n    public id: string;\r\n\r\n    private typeMode: string;\r\n    private cancelName: string;\r\n\r\n    private template: IRailcarEditModel;\r\n    private useTemplate: boolean;\r\n\r\n    private _senders: IDataModel[];\r\n    private _owners: IDataModel[];\r\n    private _providers: IDataModel[];\r\n    private _srorages: IDataModel[];\r\n    private _stations: IDataModel[];\r\n    private _cultures: IDataModel[];\r\n    private _classes: IDataModel[];\r\n    private _sorts: IDataModel[];\r\n    private _scales: IDataModel[];\r\n\r\n\r\n    private message: string;\r\n    private visibility: boolean;\r\n    private type: string;\r\n    private time: number;\r\n    private disableForm: boolean;\r\n\r\n\r\n    private _subscribeRouter: Subscription;\r\n\r\n\r\n    constructor(private _router: ActivatedRoute,\r\n        private _route: Router,\r\n        private _railcars: RailcarService,\r\n        private _filters: DataFilterService) {\r\n        this.railcar = <IRailcarEditModel>{};\r\n        this.template = <IRailcarEditModel>{};\r\n\r\n        this.visibility = false;\r\n        this.useTemplate = false;\r\n        this.disableForm = false;\r\n    }\r\n\r\n    ngOnInit() {\r\n        this._subscribeRouter = this._router.params.subscribe(params => {\r\n            this.id = params['id'];\r\n            this.disableForm = false;\r\n            let template = params['template'];\r\n\r\n            if (this.id !== 'add') {\r\n                this.typeMode = 'EDIT';\r\n                this.cancelName = 'CANCEL';\r\n                this.useTemplate = false;\r\n                this.getRailcar(this.id);\r\n            } else {\r\n                this.useTemplate = true;\r\n                this.typeMode = 'ADD';\r\n                this.cancelName = 'RESET';\r\n                this.railcar = <IRailcarEditModel>{};\r\n                if (template) {\r\n                    this.getRailcar(template);\r\n                } else {\r\n                    this.useTemplate = false;\r\n                }\r\n            }\r\n        });\r\n        this.loadDataForFilters();\r\n\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        this._subscribeRouter.unsubscribe();\r\n    }\r\n\r\n    public save(): void {\r\n        if (this.typeMode === 'ADD') {\r\n            this._railcars.addRailcar(this.railcar).subscribe((val: IRailcarEditModel): void => {\r\n                this.setMessage('MESSAGE.RAILCAR.SUCCESS_ADDET', 5, 'info');\r\n            }, (err: string): void => {\r\n                this.setMessage(err, 0, 'error');\r\n\r\n            });\r\n        } else {\r\n            this._railcars.updateRailcar(this.railcar).subscribe((val: IRailcarEditModel): void => {\r\n                this.setMessage('MESSAGE.RAILCAR.SUCCESS_EDIT', 5, 'info');\r\n            }, (err: string): void => {\r\n                this.setMessage(err, 0, 'error');\r\n\r\n            });\r\n        }\r\n    }\r\n\r\n    private getRailcar(id: string) {\r\n        this.setMessage('MESSAGE.LOADING', 2);\r\n        this._railcars.getRailcarId(id).subscribe(\r\n            (val: IRailcarEditModel): void => {\r\n                if (!this.useTemplate) {\r\n                    this.railcar = val;\r\n                    // TOD0: Bookmark state check; \r\n                    this.disableForm = (val.state < 0);\r\n                } else {\r\n                    this.template = val;\r\n                }\r\n            }, (err: string) => {\r\n                this.setMessage(err, 0, 'error');\r\n            });\r\n    }\r\n\r\n    private setTemplate(): void {\r\n        if (this.template) {\r\n            this.railcar = this.template;\r\n            console.log(this.template);\r\n            let unprop: Array<string>;\r\n            unprop = ['inventoryid',\r\n                'transportnumber',\r\n                'sampleroutdate',\r\n                'invoicenumber',\r\n                'invoicedate',\r\n                'invoicenet',\r\n                'invoicegross',\r\n                'invoicetare'];\r\n            unprop.forEach((prop: string): void => {\r\n                this.railcar[prop] = null;\r\n            });\r\n            console.log(this.railcar);\r\n        } else {\r\n            this.setMessage('MESSAGE.TEMPLATE_NOT_SET', 5, 'warn');\r\n        }\r\n    }\r\n\r\n    private cancel() {\r\n        if (this.typeMode === 'ADD') {\r\n            this.railcar = <IRailcarEditModel>{};\r\n        } else {\r\n            // TODO: back or list\r\n            this._route.navigate(['/railcars', { id: this.id }]);\r\n        }\r\n    }\r\n\r\n    private loadDataForFilters(): void {\r\n        this._filters.getCulturesList().subscribe((val: IDataModel[]): void => {\r\n            this._cultures = <IDataModel[]>val;\r\n        });\r\n\r\n        this._filters.getStationsList().subscribe((val: IDataModel[]): void => {\r\n            this._stations = val;\r\n        });\r\n        this._filters.getScalesTypeList().subscribe((val: IDataModel[]): void => {\r\n            this._scales = val;\r\n        });\r\n        this._filters.getStoragessList().subscribe((val: IDataModel[]): void => {\r\n            this._srorages = val;\r\n        });\r\n\r\n        this._filters.getSendersList().subscribe((val: IDataModel[]): void => {\r\n            this._senders = val;\r\n        });\r\n        this._filters.getOwnersList().subscribe((val: IDataModel[]): void => {\r\n            this._owners = val;\r\n        });\r\n        this._filters.getProvidersList().subscribe((val: IDataModel[]): void => {\r\n            this._providers = val;\r\n        });\r\n\r\n    }\r\n\r\n    private setGrossWeight() {\r\n        let sum: number = 0;\r\n        if (!!this.railcar.invoicenet) {\r\n            sum += +this.railcar.invoicenet;\r\n        }\r\n        if (!!this.railcar.invoicetare) {\r\n            sum += +this.railcar.invoicetare;\r\n        }\r\n        this.railcar.invoicegross = sum;\r\n    }\r\n\r\n    private setMessage(_mess: string, _time: number, _type: string = 'info'): void {\r\n        this.message = _mess;\r\n        this.time = _time;\r\n        this.type = _type;\r\n        this.visibility = true;\r\n    }\r\n\r\n    private changeCulture(): void {\r\n        if (\r\n            this.railcar\r\n            && '' + this.railcar.cropid\r\n            && this.railcar.cropid !== null\r\n            && this.railcar.cropid !== undefined) {\r\n            this._filters.getCultureClassesList(this.railcar.cropid).subscribe((val: IDataModel[]): void => {\r\n                this._classes = <IDataModel[]>val;\r\n            });\r\n            this._filters.getCultureSortesList(this.railcar.cropid).subscribe((val: IDataModel[]): void => {\r\n                this._sorts = <IDataModel[]>val;\r\n            });\r\n        } else {\r\n            this._classes = [];\r\n            this._sorts = [];\r\n        }\r\n    }\r\n}\r\n\r\n"],"sourceRoot":"/source/"}